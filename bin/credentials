#!/usr/bin/env node

const crypto = require('crypto');

const credentials = require('../policies/gatekeeper/credentials');
const authentication = require('../policies/gatekeeper/authentication');

const randomString = () => crypto.randomBytes(16).toString('hex');
const createCredentials = (id) => {
  const [password, passwordSalt] = [randomString(), randomString()];
  return [password,
          {id,
           passwordSalt,
           passwordHash: authentication.hashPassword(password, passwordSalt)}];
}

const [action, id] = process.argv.slice(2);
const creds = credentials.read();

switch(action) {
case 'add':
  const [password, cred] = createCredentials(id);
  console.log(`${id}:${password}`);
  creds[id] = cred;
  break;
case 'delete':
  delete creds[id];
  break;
default:
  console.error('Usage: apps (add|delete) ID');
  process.exit(1);
}

credentials.write(creds);
